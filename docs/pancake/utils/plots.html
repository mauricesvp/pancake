<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>pancake.utils.plots API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>pancake.utils.plots</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python"># Plotting utils

import glob
import math
import os
import random
from copy import copy
from pathlib import Path

import cv2
import matplotlib
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import seaborn as sns
import torch
import yaml
from PIL import Image, ImageDraw, ImageFont

from .general import xywh2xyxy, xyxy2xywh
from .metrics import fitness

# Settings
matplotlib.rc(&#34;font&#34;, **{&#34;size&#34;: 11})
matplotlib.use(&#34;Agg&#34;)  # for writing to files only


class Colors:
    # Ultralytics color palette https://ultralytics.com/
    def __init__(self):
        self.palette = [
            self.hex2rgb(c) for c in matplotlib.colors.TABLEAU_COLORS.values()
        ]
        self.n = len(self.palette)

    def __call__(self, i, bgr=False):
        c = self.palette[int(i) % self.n]
        return (c[2], c[1], c[0]) if bgr else c

    @staticmethod
    def hex2rgb(h):  # rgb order (PIL)
        return tuple(int(h[1 + i : 1 + i + 2], 16) for i in (0, 2, 4))


colors = Colors()  # create instance for &#39;from utils.plots import colors&#39;


def hist2d(x, y, n=100):
    # 2d histogram used in labels.png and evolve.png
    xedges, yedges = np.linspace(x.min(), x.max(), n), np.linspace(y.min(), y.max(), n)
    hist, xedges, yedges = np.histogram2d(x, y, (xedges, yedges))
    xidx = np.clip(np.digitize(x, xedges) - 1, 0, hist.shape[0] - 1)
    yidx = np.clip(np.digitize(y, yedges) - 1, 0, hist.shape[1] - 1)
    return np.log(hist[xidx, yidx])


def butter_lowpass_filtfilt(data, cutoff=1500, fs=50000, order=5):
    from scipy.signal import butter, filtfilt

    # https://stackoverflow.com/questions/28536191/how-to-filter-smooth-with-scipy-numpy
    def butter_lowpass(cutoff, fs, order):
        nyq = 0.5 * fs
        normal_cutoff = cutoff / nyq
        return butter(order, normal_cutoff, btype=&#34;low&#34;, analog=False)

    b, a = butter_lowpass(cutoff, fs, order=order)
    return filtfilt(b, a, data)  # forward-backward filter


def plot_one_box(x, im, color=None, label=None, line_thickness=3):
    # Plots one bounding box on image &#39;im&#39; using OpenCV
    assert (
        im.data.contiguous
    ), &#34;Image not contiguous. Apply np.ascontiguousarray(im) to plot_on_box() input image.&#34;
    tl = (
        line_thickness or round(0.002 * (im.shape[0] + im.shape[1]) / 2) + 1
    )  # line/font thickness
    color = color or [random.randint(0, 255) for _ in range(3)]
    c1, c2 = (int(x[0]), int(x[1])), (int(x[2]), int(x[3]))
    cv2.rectangle(im, c1, c2, color, thickness=tl, lineType=cv2.LINE_AA)
    if label:
        tf = max(tl - 1, 1)  # font thickness
        t_size = cv2.getTextSize(label, 0, fontScale=tl / 3, thickness=tf)[0]
        c2 = c1[0] + t_size[0], c1[1] - t_size[1] - 3
        cv2.rectangle(im, c1, c2, color, -1, cv2.LINE_AA)  # filled
        cv2.putText(
            im,
            label,
            (c1[0], c1[1] - 2),
            0,
            tl / 3,
            [225, 255, 255],
            thickness=tf,
            lineType=cv2.LINE_AA,
        )


def plot_one_box_PIL(box, im, color=None, label=None, line_thickness=None):
    # Plots one bounding box on image &#39;im&#39; using PIL
    im = Image.fromarray(im)
    draw = ImageDraw.Draw(im)
    line_thickness = line_thickness or max(int(min(im.size) / 200), 2)
    draw.rectangle(box, width=line_thickness, outline=tuple(color))  # plot
    if label:
        fontsize = max(round(max(im.size) / 40), 12)
        font = ImageFont.truetype(&#34;Arial.ttf&#34;, fontsize)
        txt_width, txt_height = font.getsize(label)
        draw.rectangle(
            [box[0], box[1] - txt_height + 4, box[0] + txt_width, box[1]],
            fill=tuple(color),
        )
        draw.text(
            (box[0], box[1] - txt_height + 1), label, fill=(255, 255, 255), font=font
        )
    return np.asarray(im)


def plot_wh_methods():  # from utils.plots import *; plot_wh_methods()
    # Compares the two methods for width-height anchor multiplication
    # https://github.com/ultralytics/yolov3/issues/168
    x = np.arange(-4.0, 4.0, 0.1)
    ya = np.exp(x)
    yb = torch.sigmoid(torch.from_numpy(x)).numpy() * 2

    fig = plt.figure(figsize=(6, 3), tight_layout=True)
    plt.plot(x, ya, &#34;.-&#34;, label=&#34;YOLOv3&#34;)
    plt.plot(x, yb ** 2, &#34;.-&#34;, label=&#34;YOLOv5 ^2&#34;)
    plt.plot(x, yb ** 1.6, &#34;.-&#34;, label=&#34;YOLOv5 ^1.6&#34;)
    plt.xlim(left=-4, right=4)
    plt.ylim(bottom=0, top=6)
    plt.xlabel(&#34;input&#34;)
    plt.ylabel(&#34;output&#34;)
    plt.grid()
    plt.legend()
    fig.savefig(&#34;comparison.png&#34;, dpi=200)


def output_to_target(output):
    # Convert model output to target format [batch_id, class_id, x, y, w, h, conf]
    targets = []
    for i, o in enumerate(output):
        for *box, conf, cls in o.cpu().numpy():
            targets.append([i, cls, *list(*xyxy2xywh(np.array(box)[None])), conf])
    return np.array(targets)


def plot_images(
    images,
    targets,
    paths=None,
    fname=&#34;images.jpg&#34;,
    names=None,
    max_size=640,
    max_subplots=16,
):
    # Plot image grid with labels

    if isinstance(images, torch.Tensor):
        images = images.cpu().float().numpy()
    if isinstance(targets, torch.Tensor):
        targets = targets.cpu().numpy()

    # un-normalise
    if np.max(images[0]) &lt;= 1:
        images *= 255

    tl = 3  # line thickness
    tf = max(tl - 1, 1)  # font thickness
    bs, _, h, w = images.shape  # batch size, _, height, width
    bs = min(bs, max_subplots)  # limit plot images
    ns = np.ceil(bs ** 0.5)  # number of subplots (square)

    # Check if we should resize
    scale_factor = max_size / max(h, w)
    if scale_factor &lt; 1:
        h = math.ceil(scale_factor * h)
        w = math.ceil(scale_factor * w)

    mosaic = np.full((int(ns * h), int(ns * w), 3), 255, dtype=np.uint8)  # init
    for i, img in enumerate(images):
        if i == max_subplots:  # if last batch has fewer images than we expect
            break

        block_x = int(w * (i // ns))
        block_y = int(h * (i % ns))

        img = img.transpose(1, 2, 0)
        if scale_factor &lt; 1:
            img = cv2.resize(img, (w, h))

        mosaic[block_y : block_y + h, block_x : block_x + w, :] = img
        if len(targets) &gt; 0:
            image_targets = targets[targets[:, 0] == i]
            boxes = xywh2xyxy(image_targets[:, 2:6]).T
            classes = image_targets[:, 1].astype(&#34;int&#34;)
            labels = image_targets.shape[1] == 6  # labels if no conf column
            conf = (
                None if labels else image_targets[:, 6]
            )  # check for confidence presence (label vs pred)

            if boxes.shape[1]:
                if boxes.max() &lt;= 1.01:  # if normalized with tolerance 0.01
                    boxes[[0, 2]] *= w  # scale to pixels
                    boxes[[1, 3]] *= h
                elif scale_factor &lt; 1:  # absolute coords need scale if image scales
                    boxes *= scale_factor
            boxes[[0, 2]] += block_x
            boxes[[1, 3]] += block_y
            for j, box in enumerate(boxes.T):
                cls = int(classes[j])
                color = colors(cls)
                cls = names[cls] if names else cls
                if labels or conf[j] &gt; 0.25:  # 0.25 conf thresh
                    label = &#34;%s&#34; % cls if labels else &#34;%s %.1f&#34; % (cls, conf[j])
                    plot_one_box(
                        box, mosaic, label=label, color=color, line_thickness=tl
                    )

        # Draw image filename labels
        if paths:
            label = Path(paths[i]).name[:40]  # trim to 40 char
            t_size = cv2.getTextSize(label, 0, fontScale=tl / 3, thickness=tf)[0]
            cv2.putText(
                mosaic,
                label,
                (block_x + 5, block_y + t_size[1] + 5),
                0,
                tl / 3,
                [220, 220, 220],
                thickness=tf,
                lineType=cv2.LINE_AA,
            )

        # Image border
        cv2.rectangle(
            mosaic,
            (block_x, block_y),
            (block_x + w, block_y + h),
            (255, 255, 255),
            thickness=3,
        )

    if fname:
        r = min(1280.0 / max(h, w) / ns, 1.0)  # ratio to limit image size
        mosaic = cv2.resize(
            mosaic, (int(ns * w * r), int(ns * h * r)), interpolation=cv2.INTER_AREA
        )
        # cv2.imwrite(fname, cv2.cvtColor(mosaic, cv2.COLOR_BGR2RGB))  # cv2 save
        Image.fromarray(mosaic).save(fname)  # PIL save
    return mosaic


def plot_lr_scheduler(optimizer, scheduler, epochs=300, save_dir=&#34;&#34;):
    # Plot LR simulating training for full epochs
    optimizer, scheduler = copy(optimizer), copy(scheduler)  # do not modify originals
    y = []
    for _ in range(epochs):
        scheduler.step()
        y.append(optimizer.param_groups[0][&#34;lr&#34;])
    plt.plot(y, &#34;.-&#34;, label=&#34;LR&#34;)
    plt.xlabel(&#34;epoch&#34;)
    plt.ylabel(&#34;LR&#34;)
    plt.grid()
    plt.xlim(0, epochs)
    plt.ylim(0)
    plt.savefig(Path(save_dir) / &#34;LR.png&#34;, dpi=200)
    plt.close()


def plot_test_txt():  # from utils.plots import *; plot_test()
    # Plot test.txt histograms
    x = np.loadtxt(&#34;test.txt&#34;, dtype=np.float32)
    box = xyxy2xywh(x[:, :4])
    cx, cy = box[:, 0], box[:, 1]

    fig, ax = plt.subplots(1, 1, figsize=(6, 6), tight_layout=True)
    ax.hist2d(cx, cy, bins=600, cmax=10, cmin=0)
    ax.set_aspect(&#34;equal&#34;)
    plt.savefig(&#34;hist2d.png&#34;, dpi=300)

    fig, ax = plt.subplots(1, 2, figsize=(12, 6), tight_layout=True)
    ax[0].hist(cx, bins=600)
    ax[1].hist(cy, bins=600)
    plt.savefig(&#34;hist1d.png&#34;, dpi=200)


def plot_targets_txt():  # from utils.plots import *; plot_targets_txt()
    # Plot targets.txt histograms
    x = np.loadtxt(&#34;targets.txt&#34;, dtype=np.float32).T
    s = [&#34;x targets&#34;, &#34;y targets&#34;, &#34;width targets&#34;, &#34;height targets&#34;]
    fig, ax = plt.subplots(2, 2, figsize=(8, 8), tight_layout=True)
    ax = ax.ravel()
    for i in range(4):
        ax[i].hist(x[i], bins=100, label=&#34;%.3g +/- %.3g&#34; % (x[i].mean(), x[i].std()))
        ax[i].legend()
        ax[i].set_title(s[i])
    plt.savefig(&#34;targets.jpg&#34;, dpi=200)


def plot_study_txt(path=&#34;&#34;, x=None):  # from utils.plots import *; plot_study_txt()
    # Plot study.txt generated by test.py
    fig, ax = plt.subplots(2, 4, figsize=(10, 6), tight_layout=True)
    # ax = ax.ravel()

    fig2, ax2 = plt.subplots(1, 1, figsize=(8, 4), tight_layout=True)
    # for f in [Path(path) / f&#39;study_coco_{x}.txt&#39; for x in [&#39;yolov5s6&#39;, &#39;yolov5m6&#39;, &#39;yolov5l6&#39;, &#39;yolov5x6&#39;]]:
    for f in sorted(Path(path).glob(&#34;study*.txt&#34;)):
        y = np.loadtxt(f, dtype=np.float32, usecols=[0, 1, 2, 3, 7, 8, 9], ndmin=2).T
        x = np.arange(y.shape[1]) if x is None else np.array(x)
        s = [
            &#34;P&#34;,
            &#34;R&#34;,
            &#34;mAP@.5&#34;,
            &#34;mAP@.5:.95&#34;,
            &#34;t_inference (ms/img)&#34;,
            &#34;t_NMS (ms/img)&#34;,
            &#34;t_total (ms/img)&#34;,
        ]
        # for i in range(7):
        #     ax[i].plot(x, y[i], &#39;.-&#39;, linewidth=2, markersize=8)
        #     ax[i].set_title(s[i])

        j = y[3].argmax() + 1
        ax2.plot(
            y[6, 1:j],
            y[3, 1:j] * 1e2,
            &#34;.-&#34;,
            linewidth=2,
            markersize=8,
            label=f.stem.replace(&#34;study_coco_&#34;, &#34;&#34;).replace(&#34;yolo&#34;, &#34;YOLO&#34;),
        )

    ax2.plot(
        1e3 / np.array([209, 140, 97, 58, 35, 18]),
        [34.6, 40.5, 43.0, 47.5, 49.7, 51.5],
        &#34;k.-&#34;,
        linewidth=2,
        markersize=8,
        alpha=0.25,
        label=&#34;EfficientDet&#34;,
    )

    ax2.grid(alpha=0.2)
    ax2.set_yticks(np.arange(20, 60, 5))
    ax2.set_xlim(0, 57)
    ax2.set_ylim(30, 55)
    ax2.set_xlabel(&#34;GPU Speed (ms/img)&#34;)
    ax2.set_ylabel(&#34;COCO AP val&#34;)
    ax2.legend(loc=&#34;lower right&#34;)
    plt.savefig(str(Path(path).name) + &#34;.png&#34;, dpi=300)


def plot_labels(labels, names=(), save_dir=Path(&#34;&#34;), loggers=None):
    # plot dataset labels
    print(&#34;Plotting labels... &#34;)
    c, b = labels[:, 0], labels[:, 1:].transpose()  # classes, boxes
    nc = int(c.max() + 1)  # number of classes
    x = pd.DataFrame(b.transpose(), columns=[&#34;x&#34;, &#34;y&#34;, &#34;width&#34;, &#34;height&#34;])

    # seaborn correlogram
    sns.pairplot(
        x,
        corner=True,
        diag_kind=&#34;auto&#34;,
        kind=&#34;hist&#34;,
        diag_kws=dict(bins=50),
        plot_kws=dict(pmax=0.9),
    )
    plt.savefig(save_dir / &#34;labels_correlogram.jpg&#34;, dpi=200)
    plt.close()

    # matplotlib labels
    matplotlib.use(&#34;svg&#34;)  # faster
    ax = plt.subplots(2, 2, figsize=(8, 8), tight_layout=True)[1].ravel()
    ax[0].hist(c, bins=np.linspace(0, nc, nc + 1) - 0.5, rwidth=0.8)
    ax[0].set_ylabel(&#34;instances&#34;)
    if 0 &lt; len(names) &lt; 30:
        ax[0].set_xticks(range(len(names)))
        ax[0].set_xticklabels(names, rotation=90, fontsize=10)
    else:
        ax[0].set_xlabel(&#34;classes&#34;)
    sns.histplot(x, x=&#34;x&#34;, y=&#34;y&#34;, ax=ax[2], bins=50, pmax=0.9)
    sns.histplot(x, x=&#34;width&#34;, y=&#34;height&#34;, ax=ax[3], bins=50, pmax=0.9)

    # rectangles
    labels[:, 1:3] = 0.5  # center
    labels[:, 1:] = xywh2xyxy(labels[:, 1:]) * 2000
    img = Image.fromarray(np.ones((2000, 2000, 3), dtype=np.uint8) * 255)
    for cls, *box in labels[:1000]:
        ImageDraw.Draw(img).rectangle(box, width=1, outline=colors(cls))  # plot
    ax[1].imshow(img)
    ax[1].axis(&#34;off&#34;)

    for a in [0, 1, 2, 3]:
        for s in [&#34;top&#34;, &#34;right&#34;, &#34;left&#34;, &#34;bottom&#34;]:
            ax[a].spines[s].set_visible(False)

    plt.savefig(save_dir / &#34;labels.jpg&#34;, dpi=200)
    matplotlib.use(&#34;Agg&#34;)
    plt.close()

    # loggers
    for k, v in loggers.items() or {}:
        if k == &#34;wandb&#34; and v:
            v.log(
                {
                    &#34;Labels&#34;: [
                        v.Image(str(x), caption=x.name)
                        for x in save_dir.glob(&#34;*labels*.jpg&#34;)
                    ]
                },
                commit=False,
            )


def plot_evolution(
    yaml_file=&#34;data/hyp.finetune.yaml&#34;,
):  # from utils.plots import *; plot_evolution()
    # Plot hyperparameter evolution results in evolve.txt
    with open(yaml_file) as f:
        hyp = yaml.safe_load(f)
    x = np.loadtxt(&#34;evolve.txt&#34;, ndmin=2)
    f = fitness(x)
    # weights = (f - f.min()) ** 2  # for weighted results
    plt.figure(figsize=(10, 12), tight_layout=True)
    matplotlib.rc(&#34;font&#34;, **{&#34;size&#34;: 8})
    for i, (k, v) in enumerate(hyp.items()):
        y = x[:, i + 7]
        # mu = (y * weights).sum() / weights.sum()  # best weighted result
        mu = y[f.argmax()]  # best single result
        plt.subplot(6, 5, i + 1)
        plt.scatter(
            y, f, c=hist2d(y, f, 20), cmap=&#34;viridis&#34;, alpha=0.8, edgecolors=&#34;none&#34;
        )
        plt.plot(mu, f.max(), &#34;k+&#34;, markersize=15)
        plt.title(&#34;%s = %.3g&#34; % (k, mu), fontdict={&#34;size&#34;: 9})  # limit to 40 characters
        if i % 5 != 0:
            plt.yticks([])
        print(&#34;%15s: %.3g&#34; % (k, mu))
    plt.savefig(&#34;evolve.png&#34;, dpi=200)
    print(&#34;\nPlot saved as evolve.png&#34;)


def profile_idetection(start=0, stop=0, labels=(), save_dir=&#34;&#34;):
    # Plot iDetection &#39;*.txt&#39; per-image logs. from utils.plots import *; profile_idetection()
    ax = plt.subplots(2, 4, figsize=(12, 6), tight_layout=True)[1].ravel()
    s = [
        &#34;Images&#34;,
        &#34;Free Storage (GB)&#34;,
        &#34;RAM Usage (GB)&#34;,
        &#34;Battery&#34;,
        &#34;dt_raw (ms)&#34;,
        &#34;dt_smooth (ms)&#34;,
        &#34;real-world FPS&#34;,
    ]
    files = list(Path(save_dir).glob(&#34;frames*.txt&#34;))
    for fi, f in enumerate(files):
        try:
            results = np.loadtxt(f, ndmin=2).T[:, 90:-30]  # clip first and last rows
            n = results.shape[1]  # number of rows
            x = np.arange(start, min(stop, n) if stop else n)
            results = results[:, x]
            t = results[0] - results[0].min()  # set t0=0s
            results[0] = x
            for i, a in enumerate(ax):
                if i &lt; len(results):
                    label = labels[fi] if len(labels) else f.stem.replace(&#34;frames_&#34;, &#34;&#34;)
                    a.plot(
                        t,
                        results[i],
                        marker=&#34;.&#34;,
                        label=label,
                        linewidth=1,
                        markersize=5,
                    )
                    a.set_title(s[i])
                    a.set_xlabel(&#34;time (s)&#34;)
                    # if fi == len(files) - 1:
                    #     a.set_ylim(bottom=0)
                    for side in [&#34;top&#34;, &#34;right&#34;]:
                        a.spines[side].set_visible(False)
                else:
                    a.remove()
        except Exception as e:
            print(&#34;Warning: Plotting error for %s; %s&#34; % (f, e))

    ax[1].legend()
    plt.savefig(Path(save_dir) / &#34;idetection_profile.png&#34;, dpi=200)


def plot_results_overlay(
    start=0, stop=0
):  # from utils.plots import *; plot_results_overlay()
    # Plot training &#39;results*.txt&#39;, overlaying train and val losses
    s = [
        &#34;train&#34;,
        &#34;train&#34;,
        &#34;train&#34;,
        &#34;Precision&#34;,
        &#34;mAP@0.5&#34;,
        &#34;val&#34;,
        &#34;val&#34;,
        &#34;val&#34;,
        &#34;Recall&#34;,
        &#34;mAP@0.5:0.95&#34;,
    ]  # legends
    t = [&#34;Box&#34;, &#34;Objectness&#34;, &#34;Classification&#34;, &#34;P-R&#34;, &#34;mAP-F1&#34;]  # titles
    for f in sorted(
        glob.glob(&#34;results*.txt&#34;) + glob.glob(&#34;../../Downloads/results*.txt&#34;)
    ):
        results = np.loadtxt(f, usecols=[2, 3, 4, 8, 9, 12, 13, 14, 10, 11], ndmin=2).T
        n = results.shape[1]  # number of rows
        x = range(start, min(stop, n) if stop else n)
        fig, ax = plt.subplots(1, 5, figsize=(14, 3.5), tight_layout=True)
        ax = ax.ravel()
        for i in range(5):
            for j in [i, i + 5]:
                y = results[j, x]
                ax[i].plot(x, y, marker=&#34;.&#34;, label=s[j])
                # y_smooth = butter_lowpass_filtfilt(y)
                # ax[i].plot(x, np.gradient(y_smooth), marker=&#39;.&#39;, label=s[j])

            ax[i].set_title(t[i])
            ax[i].legend()
            ax[i].set_ylabel(f) if i == 0 else None  # add filename
        fig.savefig(f.replace(&#34;.txt&#34;, &#34;.png&#34;), dpi=200)


def plot_results(start=0, stop=0, bucket=&#34;&#34;, id=(), labels=(), save_dir=&#34;&#34;):
    # Plot training &#39;results*.txt&#39;. from utils.plots import *; plot_results(save_dir=&#39;runs/train/exp&#39;)
    fig, ax = plt.subplots(2, 5, figsize=(12, 6), tight_layout=True)
    ax = ax.ravel()
    s = [
        &#34;Box&#34;,
        &#34;Objectness&#34;,
        &#34;Classification&#34;,
        &#34;Precision&#34;,
        &#34;Recall&#34;,
        &#34;val Box&#34;,
        &#34;val Objectness&#34;,
        &#34;val Classification&#34;,
        &#34;mAP@0.5&#34;,
        &#34;mAP@0.5:0.95&#34;,
    ]
    if bucket:
        # files = [&#39;https://storage.googleapis.com/%s/results%g.txt&#39; % (bucket, x) for x in id]
        files = [&#34;results%g.txt&#34; % x for x in id]
        c = (&#34;gsutil cp &#34; + &#34;%s &#34; * len(files) + &#34;.&#34;) % tuple(
            &#34;gs://%s/results%g.txt&#34; % (bucket, x) for x in id
        )
        os.system(c)
    else:
        files = list(Path(save_dir).glob(&#34;results*.txt&#34;))
    assert len(
        files
    ), &#34;No results.txt files found in %s, nothing to plot.&#34; % os.path.abspath(save_dir)
    for fi, f in enumerate(files):
        try:
            results = np.loadtxt(
                f, usecols=[2, 3, 4, 8, 9, 12, 13, 14, 10, 11], ndmin=2
            ).T
            n = results.shape[1]  # number of rows
            x = range(start, min(stop, n) if stop else n)
            for i in range(10):
                y = results[i, x]
                if i in [0, 1, 2, 5, 6, 7]:
                    y[y == 0] = np.nan  # don&#39;t show zero loss values
                    # y /= y[0]  # normalize
                label = labels[fi] if len(labels) else f.stem
                ax[i].plot(x, y, marker=&#34;.&#34;, label=label, linewidth=2, markersize=8)
                ax[i].set_title(s[i])
                # if i in [5, 6, 7]:  # share train and val loss y axes
                #     ax[i].get_shared_y_axes().join(ax[i], ax[i - 5])
        except Exception as e:
            print(&#34;Warning: Plotting error for %s; %s&#34; % (f, e))

    ax[1].legend()
    fig.savefig(Path(save_dir) / &#34;results.png&#34;, dpi=200)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="pancake.utils.plots.butter_lowpass_filtfilt"><code class="name flex">
<span>def <span class="ident">butter_lowpass_filtfilt</span></span>(<span>data, cutoff=1500, fs=50000, order=5)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def butter_lowpass_filtfilt(data, cutoff=1500, fs=50000, order=5):
    from scipy.signal import butter, filtfilt

    # https://stackoverflow.com/questions/28536191/how-to-filter-smooth-with-scipy-numpy
    def butter_lowpass(cutoff, fs, order):
        nyq = 0.5 * fs
        normal_cutoff = cutoff / nyq
        return butter(order, normal_cutoff, btype=&#34;low&#34;, analog=False)

    b, a = butter_lowpass(cutoff, fs, order=order)
    return filtfilt(b, a, data)  # forward-backward filter</code></pre>
</details>
</dd>
<dt id="pancake.utils.plots.hist2d"><code class="name flex">
<span>def <span class="ident">hist2d</span></span>(<span>x, y, n=100)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def hist2d(x, y, n=100):
    # 2d histogram used in labels.png and evolve.png
    xedges, yedges = np.linspace(x.min(), x.max(), n), np.linspace(y.min(), y.max(), n)
    hist, xedges, yedges = np.histogram2d(x, y, (xedges, yedges))
    xidx = np.clip(np.digitize(x, xedges) - 1, 0, hist.shape[0] - 1)
    yidx = np.clip(np.digitize(y, yedges) - 1, 0, hist.shape[1] - 1)
    return np.log(hist[xidx, yidx])</code></pre>
</details>
</dd>
<dt id="pancake.utils.plots.output_to_target"><code class="name flex">
<span>def <span class="ident">output_to_target</span></span>(<span>output)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def output_to_target(output):
    # Convert model output to target format [batch_id, class_id, x, y, w, h, conf]
    targets = []
    for i, o in enumerate(output):
        for *box, conf, cls in o.cpu().numpy():
            targets.append([i, cls, *list(*xyxy2xywh(np.array(box)[None])), conf])
    return np.array(targets)</code></pre>
</details>
</dd>
<dt id="pancake.utils.plots.plot_evolution"><code class="name flex">
<span>def <span class="ident">plot_evolution</span></span>(<span>yaml_file='data/hyp.finetune.yaml')</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_evolution(
    yaml_file=&#34;data/hyp.finetune.yaml&#34;,
):  # from utils.plots import *; plot_evolution()
    # Plot hyperparameter evolution results in evolve.txt
    with open(yaml_file) as f:
        hyp = yaml.safe_load(f)
    x = np.loadtxt(&#34;evolve.txt&#34;, ndmin=2)
    f = fitness(x)
    # weights = (f - f.min()) ** 2  # for weighted results
    plt.figure(figsize=(10, 12), tight_layout=True)
    matplotlib.rc(&#34;font&#34;, **{&#34;size&#34;: 8})
    for i, (k, v) in enumerate(hyp.items()):
        y = x[:, i + 7]
        # mu = (y * weights).sum() / weights.sum()  # best weighted result
        mu = y[f.argmax()]  # best single result
        plt.subplot(6, 5, i + 1)
        plt.scatter(
            y, f, c=hist2d(y, f, 20), cmap=&#34;viridis&#34;, alpha=0.8, edgecolors=&#34;none&#34;
        )
        plt.plot(mu, f.max(), &#34;k+&#34;, markersize=15)
        plt.title(&#34;%s = %.3g&#34; % (k, mu), fontdict={&#34;size&#34;: 9})  # limit to 40 characters
        if i % 5 != 0:
            plt.yticks([])
        print(&#34;%15s: %.3g&#34; % (k, mu))
    plt.savefig(&#34;evolve.png&#34;, dpi=200)
    print(&#34;\nPlot saved as evolve.png&#34;)</code></pre>
</details>
</dd>
<dt id="pancake.utils.plots.plot_images"><code class="name flex">
<span>def <span class="ident">plot_images</span></span>(<span>images, targets, paths=None, fname='images.jpg', names=None, max_size=640, max_subplots=16)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_images(
    images,
    targets,
    paths=None,
    fname=&#34;images.jpg&#34;,
    names=None,
    max_size=640,
    max_subplots=16,
):
    # Plot image grid with labels

    if isinstance(images, torch.Tensor):
        images = images.cpu().float().numpy()
    if isinstance(targets, torch.Tensor):
        targets = targets.cpu().numpy()

    # un-normalise
    if np.max(images[0]) &lt;= 1:
        images *= 255

    tl = 3  # line thickness
    tf = max(tl - 1, 1)  # font thickness
    bs, _, h, w = images.shape  # batch size, _, height, width
    bs = min(bs, max_subplots)  # limit plot images
    ns = np.ceil(bs ** 0.5)  # number of subplots (square)

    # Check if we should resize
    scale_factor = max_size / max(h, w)
    if scale_factor &lt; 1:
        h = math.ceil(scale_factor * h)
        w = math.ceil(scale_factor * w)

    mosaic = np.full((int(ns * h), int(ns * w), 3), 255, dtype=np.uint8)  # init
    for i, img in enumerate(images):
        if i == max_subplots:  # if last batch has fewer images than we expect
            break

        block_x = int(w * (i // ns))
        block_y = int(h * (i % ns))

        img = img.transpose(1, 2, 0)
        if scale_factor &lt; 1:
            img = cv2.resize(img, (w, h))

        mosaic[block_y : block_y + h, block_x : block_x + w, :] = img
        if len(targets) &gt; 0:
            image_targets = targets[targets[:, 0] == i]
            boxes = xywh2xyxy(image_targets[:, 2:6]).T
            classes = image_targets[:, 1].astype(&#34;int&#34;)
            labels = image_targets.shape[1] == 6  # labels if no conf column
            conf = (
                None if labels else image_targets[:, 6]
            )  # check for confidence presence (label vs pred)

            if boxes.shape[1]:
                if boxes.max() &lt;= 1.01:  # if normalized with tolerance 0.01
                    boxes[[0, 2]] *= w  # scale to pixels
                    boxes[[1, 3]] *= h
                elif scale_factor &lt; 1:  # absolute coords need scale if image scales
                    boxes *= scale_factor
            boxes[[0, 2]] += block_x
            boxes[[1, 3]] += block_y
            for j, box in enumerate(boxes.T):
                cls = int(classes[j])
                color = colors(cls)
                cls = names[cls] if names else cls
                if labels or conf[j] &gt; 0.25:  # 0.25 conf thresh
                    label = &#34;%s&#34; % cls if labels else &#34;%s %.1f&#34; % (cls, conf[j])
                    plot_one_box(
                        box, mosaic, label=label, color=color, line_thickness=tl
                    )

        # Draw image filename labels
        if paths:
            label = Path(paths[i]).name[:40]  # trim to 40 char
            t_size = cv2.getTextSize(label, 0, fontScale=tl / 3, thickness=tf)[0]
            cv2.putText(
                mosaic,
                label,
                (block_x + 5, block_y + t_size[1] + 5),
                0,
                tl / 3,
                [220, 220, 220],
                thickness=tf,
                lineType=cv2.LINE_AA,
            )

        # Image border
        cv2.rectangle(
            mosaic,
            (block_x, block_y),
            (block_x + w, block_y + h),
            (255, 255, 255),
            thickness=3,
        )

    if fname:
        r = min(1280.0 / max(h, w) / ns, 1.0)  # ratio to limit image size
        mosaic = cv2.resize(
            mosaic, (int(ns * w * r), int(ns * h * r)), interpolation=cv2.INTER_AREA
        )
        # cv2.imwrite(fname, cv2.cvtColor(mosaic, cv2.COLOR_BGR2RGB))  # cv2 save
        Image.fromarray(mosaic).save(fname)  # PIL save
    return mosaic</code></pre>
</details>
</dd>
<dt id="pancake.utils.plots.plot_labels"><code class="name flex">
<span>def <span class="ident">plot_labels</span></span>(<span>labels, names=(), save_dir=PosixPath('.'), loggers=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_labels(labels, names=(), save_dir=Path(&#34;&#34;), loggers=None):
    # plot dataset labels
    print(&#34;Plotting labels... &#34;)
    c, b = labels[:, 0], labels[:, 1:].transpose()  # classes, boxes
    nc = int(c.max() + 1)  # number of classes
    x = pd.DataFrame(b.transpose(), columns=[&#34;x&#34;, &#34;y&#34;, &#34;width&#34;, &#34;height&#34;])

    # seaborn correlogram
    sns.pairplot(
        x,
        corner=True,
        diag_kind=&#34;auto&#34;,
        kind=&#34;hist&#34;,
        diag_kws=dict(bins=50),
        plot_kws=dict(pmax=0.9),
    )
    plt.savefig(save_dir / &#34;labels_correlogram.jpg&#34;, dpi=200)
    plt.close()

    # matplotlib labels
    matplotlib.use(&#34;svg&#34;)  # faster
    ax = plt.subplots(2, 2, figsize=(8, 8), tight_layout=True)[1].ravel()
    ax[0].hist(c, bins=np.linspace(0, nc, nc + 1) - 0.5, rwidth=0.8)
    ax[0].set_ylabel(&#34;instances&#34;)
    if 0 &lt; len(names) &lt; 30:
        ax[0].set_xticks(range(len(names)))
        ax[0].set_xticklabels(names, rotation=90, fontsize=10)
    else:
        ax[0].set_xlabel(&#34;classes&#34;)
    sns.histplot(x, x=&#34;x&#34;, y=&#34;y&#34;, ax=ax[2], bins=50, pmax=0.9)
    sns.histplot(x, x=&#34;width&#34;, y=&#34;height&#34;, ax=ax[3], bins=50, pmax=0.9)

    # rectangles
    labels[:, 1:3] = 0.5  # center
    labels[:, 1:] = xywh2xyxy(labels[:, 1:]) * 2000
    img = Image.fromarray(np.ones((2000, 2000, 3), dtype=np.uint8) * 255)
    for cls, *box in labels[:1000]:
        ImageDraw.Draw(img).rectangle(box, width=1, outline=colors(cls))  # plot
    ax[1].imshow(img)
    ax[1].axis(&#34;off&#34;)

    for a in [0, 1, 2, 3]:
        for s in [&#34;top&#34;, &#34;right&#34;, &#34;left&#34;, &#34;bottom&#34;]:
            ax[a].spines[s].set_visible(False)

    plt.savefig(save_dir / &#34;labels.jpg&#34;, dpi=200)
    matplotlib.use(&#34;Agg&#34;)
    plt.close()

    # loggers
    for k, v in loggers.items() or {}:
        if k == &#34;wandb&#34; and v:
            v.log(
                {
                    &#34;Labels&#34;: [
                        v.Image(str(x), caption=x.name)
                        for x in save_dir.glob(&#34;*labels*.jpg&#34;)
                    ]
                },
                commit=False,
            )</code></pre>
</details>
</dd>
<dt id="pancake.utils.plots.plot_lr_scheduler"><code class="name flex">
<span>def <span class="ident">plot_lr_scheduler</span></span>(<span>optimizer, scheduler, epochs=300, save_dir='')</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_lr_scheduler(optimizer, scheduler, epochs=300, save_dir=&#34;&#34;):
    # Plot LR simulating training for full epochs
    optimizer, scheduler = copy(optimizer), copy(scheduler)  # do not modify originals
    y = []
    for _ in range(epochs):
        scheduler.step()
        y.append(optimizer.param_groups[0][&#34;lr&#34;])
    plt.plot(y, &#34;.-&#34;, label=&#34;LR&#34;)
    plt.xlabel(&#34;epoch&#34;)
    plt.ylabel(&#34;LR&#34;)
    plt.grid()
    plt.xlim(0, epochs)
    plt.ylim(0)
    plt.savefig(Path(save_dir) / &#34;LR.png&#34;, dpi=200)
    plt.close()</code></pre>
</details>
</dd>
<dt id="pancake.utils.plots.plot_one_box"><code class="name flex">
<span>def <span class="ident">plot_one_box</span></span>(<span>x, im, color=None, label=None, line_thickness=3)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_one_box(x, im, color=None, label=None, line_thickness=3):
    # Plots one bounding box on image &#39;im&#39; using OpenCV
    assert (
        im.data.contiguous
    ), &#34;Image not contiguous. Apply np.ascontiguousarray(im) to plot_on_box() input image.&#34;
    tl = (
        line_thickness or round(0.002 * (im.shape[0] + im.shape[1]) / 2) + 1
    )  # line/font thickness
    color = color or [random.randint(0, 255) for _ in range(3)]
    c1, c2 = (int(x[0]), int(x[1])), (int(x[2]), int(x[3]))
    cv2.rectangle(im, c1, c2, color, thickness=tl, lineType=cv2.LINE_AA)
    if label:
        tf = max(tl - 1, 1)  # font thickness
        t_size = cv2.getTextSize(label, 0, fontScale=tl / 3, thickness=tf)[0]
        c2 = c1[0] + t_size[0], c1[1] - t_size[1] - 3
        cv2.rectangle(im, c1, c2, color, -1, cv2.LINE_AA)  # filled
        cv2.putText(
            im,
            label,
            (c1[0], c1[1] - 2),
            0,
            tl / 3,
            [225, 255, 255],
            thickness=tf,
            lineType=cv2.LINE_AA,
        )</code></pre>
</details>
</dd>
<dt id="pancake.utils.plots.plot_one_box_PIL"><code class="name flex">
<span>def <span class="ident">plot_one_box_PIL</span></span>(<span>box, im, color=None, label=None, line_thickness=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_one_box_PIL(box, im, color=None, label=None, line_thickness=None):
    # Plots one bounding box on image &#39;im&#39; using PIL
    im = Image.fromarray(im)
    draw = ImageDraw.Draw(im)
    line_thickness = line_thickness or max(int(min(im.size) / 200), 2)
    draw.rectangle(box, width=line_thickness, outline=tuple(color))  # plot
    if label:
        fontsize = max(round(max(im.size) / 40), 12)
        font = ImageFont.truetype(&#34;Arial.ttf&#34;, fontsize)
        txt_width, txt_height = font.getsize(label)
        draw.rectangle(
            [box[0], box[1] - txt_height + 4, box[0] + txt_width, box[1]],
            fill=tuple(color),
        )
        draw.text(
            (box[0], box[1] - txt_height + 1), label, fill=(255, 255, 255), font=font
        )
    return np.asarray(im)</code></pre>
</details>
</dd>
<dt id="pancake.utils.plots.plot_results"><code class="name flex">
<span>def <span class="ident">plot_results</span></span>(<span>start=0, stop=0, bucket='', id=(), labels=(), save_dir='')</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_results(start=0, stop=0, bucket=&#34;&#34;, id=(), labels=(), save_dir=&#34;&#34;):
    # Plot training &#39;results*.txt&#39;. from utils.plots import *; plot_results(save_dir=&#39;runs/train/exp&#39;)
    fig, ax = plt.subplots(2, 5, figsize=(12, 6), tight_layout=True)
    ax = ax.ravel()
    s = [
        &#34;Box&#34;,
        &#34;Objectness&#34;,
        &#34;Classification&#34;,
        &#34;Precision&#34;,
        &#34;Recall&#34;,
        &#34;val Box&#34;,
        &#34;val Objectness&#34;,
        &#34;val Classification&#34;,
        &#34;mAP@0.5&#34;,
        &#34;mAP@0.5:0.95&#34;,
    ]
    if bucket:
        # files = [&#39;https://storage.googleapis.com/%s/results%g.txt&#39; % (bucket, x) for x in id]
        files = [&#34;results%g.txt&#34; % x for x in id]
        c = (&#34;gsutil cp &#34; + &#34;%s &#34; * len(files) + &#34;.&#34;) % tuple(
            &#34;gs://%s/results%g.txt&#34; % (bucket, x) for x in id
        )
        os.system(c)
    else:
        files = list(Path(save_dir).glob(&#34;results*.txt&#34;))
    assert len(
        files
    ), &#34;No results.txt files found in %s, nothing to plot.&#34; % os.path.abspath(save_dir)
    for fi, f in enumerate(files):
        try:
            results = np.loadtxt(
                f, usecols=[2, 3, 4, 8, 9, 12, 13, 14, 10, 11], ndmin=2
            ).T
            n = results.shape[1]  # number of rows
            x = range(start, min(stop, n) if stop else n)
            for i in range(10):
                y = results[i, x]
                if i in [0, 1, 2, 5, 6, 7]:
                    y[y == 0] = np.nan  # don&#39;t show zero loss values
                    # y /= y[0]  # normalize
                label = labels[fi] if len(labels) else f.stem
                ax[i].plot(x, y, marker=&#34;.&#34;, label=label, linewidth=2, markersize=8)
                ax[i].set_title(s[i])
                # if i in [5, 6, 7]:  # share train and val loss y axes
                #     ax[i].get_shared_y_axes().join(ax[i], ax[i - 5])
        except Exception as e:
            print(&#34;Warning: Plotting error for %s; %s&#34; % (f, e))

    ax[1].legend()
    fig.savefig(Path(save_dir) / &#34;results.png&#34;, dpi=200)</code></pre>
</details>
</dd>
<dt id="pancake.utils.plots.plot_results_overlay"><code class="name flex">
<span>def <span class="ident">plot_results_overlay</span></span>(<span>start=0, stop=0)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_results_overlay(
    start=0, stop=0
):  # from utils.plots import *; plot_results_overlay()
    # Plot training &#39;results*.txt&#39;, overlaying train and val losses
    s = [
        &#34;train&#34;,
        &#34;train&#34;,
        &#34;train&#34;,
        &#34;Precision&#34;,
        &#34;mAP@0.5&#34;,
        &#34;val&#34;,
        &#34;val&#34;,
        &#34;val&#34;,
        &#34;Recall&#34;,
        &#34;mAP@0.5:0.95&#34;,
    ]  # legends
    t = [&#34;Box&#34;, &#34;Objectness&#34;, &#34;Classification&#34;, &#34;P-R&#34;, &#34;mAP-F1&#34;]  # titles
    for f in sorted(
        glob.glob(&#34;results*.txt&#34;) + glob.glob(&#34;../../Downloads/results*.txt&#34;)
    ):
        results = np.loadtxt(f, usecols=[2, 3, 4, 8, 9, 12, 13, 14, 10, 11], ndmin=2).T
        n = results.shape[1]  # number of rows
        x = range(start, min(stop, n) if stop else n)
        fig, ax = plt.subplots(1, 5, figsize=(14, 3.5), tight_layout=True)
        ax = ax.ravel()
        for i in range(5):
            for j in [i, i + 5]:
                y = results[j, x]
                ax[i].plot(x, y, marker=&#34;.&#34;, label=s[j])
                # y_smooth = butter_lowpass_filtfilt(y)
                # ax[i].plot(x, np.gradient(y_smooth), marker=&#39;.&#39;, label=s[j])

            ax[i].set_title(t[i])
            ax[i].legend()
            ax[i].set_ylabel(f) if i == 0 else None  # add filename
        fig.savefig(f.replace(&#34;.txt&#34;, &#34;.png&#34;), dpi=200)</code></pre>
</details>
</dd>
<dt id="pancake.utils.plots.plot_study_txt"><code class="name flex">
<span>def <span class="ident">plot_study_txt</span></span>(<span>path='', x=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_study_txt(path=&#34;&#34;, x=None):  # from utils.plots import *; plot_study_txt()
    # Plot study.txt generated by test.py
    fig, ax = plt.subplots(2, 4, figsize=(10, 6), tight_layout=True)
    # ax = ax.ravel()

    fig2, ax2 = plt.subplots(1, 1, figsize=(8, 4), tight_layout=True)
    # for f in [Path(path) / f&#39;study_coco_{x}.txt&#39; for x in [&#39;yolov5s6&#39;, &#39;yolov5m6&#39;, &#39;yolov5l6&#39;, &#39;yolov5x6&#39;]]:
    for f in sorted(Path(path).glob(&#34;study*.txt&#34;)):
        y = np.loadtxt(f, dtype=np.float32, usecols=[0, 1, 2, 3, 7, 8, 9], ndmin=2).T
        x = np.arange(y.shape[1]) if x is None else np.array(x)
        s = [
            &#34;P&#34;,
            &#34;R&#34;,
            &#34;mAP@.5&#34;,
            &#34;mAP@.5:.95&#34;,
            &#34;t_inference (ms/img)&#34;,
            &#34;t_NMS (ms/img)&#34;,
            &#34;t_total (ms/img)&#34;,
        ]
        # for i in range(7):
        #     ax[i].plot(x, y[i], &#39;.-&#39;, linewidth=2, markersize=8)
        #     ax[i].set_title(s[i])

        j = y[3].argmax() + 1
        ax2.plot(
            y[6, 1:j],
            y[3, 1:j] * 1e2,
            &#34;.-&#34;,
            linewidth=2,
            markersize=8,
            label=f.stem.replace(&#34;study_coco_&#34;, &#34;&#34;).replace(&#34;yolo&#34;, &#34;YOLO&#34;),
        )

    ax2.plot(
        1e3 / np.array([209, 140, 97, 58, 35, 18]),
        [34.6, 40.5, 43.0, 47.5, 49.7, 51.5],
        &#34;k.-&#34;,
        linewidth=2,
        markersize=8,
        alpha=0.25,
        label=&#34;EfficientDet&#34;,
    )

    ax2.grid(alpha=0.2)
    ax2.set_yticks(np.arange(20, 60, 5))
    ax2.set_xlim(0, 57)
    ax2.set_ylim(30, 55)
    ax2.set_xlabel(&#34;GPU Speed (ms/img)&#34;)
    ax2.set_ylabel(&#34;COCO AP val&#34;)
    ax2.legend(loc=&#34;lower right&#34;)
    plt.savefig(str(Path(path).name) + &#34;.png&#34;, dpi=300)</code></pre>
</details>
</dd>
<dt id="pancake.utils.plots.plot_targets_txt"><code class="name flex">
<span>def <span class="ident">plot_targets_txt</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_targets_txt():  # from utils.plots import *; plot_targets_txt()
    # Plot targets.txt histograms
    x = np.loadtxt(&#34;targets.txt&#34;, dtype=np.float32).T
    s = [&#34;x targets&#34;, &#34;y targets&#34;, &#34;width targets&#34;, &#34;height targets&#34;]
    fig, ax = plt.subplots(2, 2, figsize=(8, 8), tight_layout=True)
    ax = ax.ravel()
    for i in range(4):
        ax[i].hist(x[i], bins=100, label=&#34;%.3g +/- %.3g&#34; % (x[i].mean(), x[i].std()))
        ax[i].legend()
        ax[i].set_title(s[i])
    plt.savefig(&#34;targets.jpg&#34;, dpi=200)</code></pre>
</details>
</dd>
<dt id="pancake.utils.plots.plot_test_txt"><code class="name flex">
<span>def <span class="ident">plot_test_txt</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_test_txt():  # from utils.plots import *; plot_test()
    # Plot test.txt histograms
    x = np.loadtxt(&#34;test.txt&#34;, dtype=np.float32)
    box = xyxy2xywh(x[:, :4])
    cx, cy = box[:, 0], box[:, 1]

    fig, ax = plt.subplots(1, 1, figsize=(6, 6), tight_layout=True)
    ax.hist2d(cx, cy, bins=600, cmax=10, cmin=0)
    ax.set_aspect(&#34;equal&#34;)
    plt.savefig(&#34;hist2d.png&#34;, dpi=300)

    fig, ax = plt.subplots(1, 2, figsize=(12, 6), tight_layout=True)
    ax[0].hist(cx, bins=600)
    ax[1].hist(cy, bins=600)
    plt.savefig(&#34;hist1d.png&#34;, dpi=200)</code></pre>
</details>
</dd>
<dt id="pancake.utils.plots.plot_wh_methods"><code class="name flex">
<span>def <span class="ident">plot_wh_methods</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_wh_methods():  # from utils.plots import *; plot_wh_methods()
    # Compares the two methods for width-height anchor multiplication
    # https://github.com/ultralytics/yolov3/issues/168
    x = np.arange(-4.0, 4.0, 0.1)
    ya = np.exp(x)
    yb = torch.sigmoid(torch.from_numpy(x)).numpy() * 2

    fig = plt.figure(figsize=(6, 3), tight_layout=True)
    plt.plot(x, ya, &#34;.-&#34;, label=&#34;YOLOv3&#34;)
    plt.plot(x, yb ** 2, &#34;.-&#34;, label=&#34;YOLOv5 ^2&#34;)
    plt.plot(x, yb ** 1.6, &#34;.-&#34;, label=&#34;YOLOv5 ^1.6&#34;)
    plt.xlim(left=-4, right=4)
    plt.ylim(bottom=0, top=6)
    plt.xlabel(&#34;input&#34;)
    plt.ylabel(&#34;output&#34;)
    plt.grid()
    plt.legend()
    fig.savefig(&#34;comparison.png&#34;, dpi=200)</code></pre>
</details>
</dd>
<dt id="pancake.utils.plots.profile_idetection"><code class="name flex">
<span>def <span class="ident">profile_idetection</span></span>(<span>start=0, stop=0, labels=(), save_dir='')</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def profile_idetection(start=0, stop=0, labels=(), save_dir=&#34;&#34;):
    # Plot iDetection &#39;*.txt&#39; per-image logs. from utils.plots import *; profile_idetection()
    ax = plt.subplots(2, 4, figsize=(12, 6), tight_layout=True)[1].ravel()
    s = [
        &#34;Images&#34;,
        &#34;Free Storage (GB)&#34;,
        &#34;RAM Usage (GB)&#34;,
        &#34;Battery&#34;,
        &#34;dt_raw (ms)&#34;,
        &#34;dt_smooth (ms)&#34;,
        &#34;real-world FPS&#34;,
    ]
    files = list(Path(save_dir).glob(&#34;frames*.txt&#34;))
    for fi, f in enumerate(files):
        try:
            results = np.loadtxt(f, ndmin=2).T[:, 90:-30]  # clip first and last rows
            n = results.shape[1]  # number of rows
            x = np.arange(start, min(stop, n) if stop else n)
            results = results[:, x]
            t = results[0] - results[0].min()  # set t0=0s
            results[0] = x
            for i, a in enumerate(ax):
                if i &lt; len(results):
                    label = labels[fi] if len(labels) else f.stem.replace(&#34;frames_&#34;, &#34;&#34;)
                    a.plot(
                        t,
                        results[i],
                        marker=&#34;.&#34;,
                        label=label,
                        linewidth=1,
                        markersize=5,
                    )
                    a.set_title(s[i])
                    a.set_xlabel(&#34;time (s)&#34;)
                    # if fi == len(files) - 1:
                    #     a.set_ylim(bottom=0)
                    for side in [&#34;top&#34;, &#34;right&#34;]:
                        a.spines[side].set_visible(False)
                else:
                    a.remove()
        except Exception as e:
            print(&#34;Warning: Plotting error for %s; %s&#34; % (f, e))

    ax[1].legend()
    plt.savefig(Path(save_dir) / &#34;idetection_profile.png&#34;, dpi=200)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="pancake.utils.plots.Colors"><code class="flex name class">
<span>class <span class="ident">Colors</span></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Colors:
    # Ultralytics color palette https://ultralytics.com/
    def __init__(self):
        self.palette = [
            self.hex2rgb(c) for c in matplotlib.colors.TABLEAU_COLORS.values()
        ]
        self.n = len(self.palette)

    def __call__(self, i, bgr=False):
        c = self.palette[int(i) % self.n]
        return (c[2], c[1], c[0]) if bgr else c

    @staticmethod
    def hex2rgb(h):  # rgb order (PIL)
        return tuple(int(h[1 + i : 1 + i + 2], 16) for i in (0, 2, 4))</code></pre>
</details>
<h3>Static methods</h3>
<dl>
<dt id="pancake.utils.plots.Colors.hex2rgb"><code class="name flex">
<span>def <span class="ident">hex2rgb</span></span>(<span>h)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def hex2rgb(h):  # rgb order (PIL)
    return tuple(int(h[1 + i : 1 + i + 2], 16) for i in (0, 2, 4))</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="pancake.utils" href="index.html">pancake.utils</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="pancake.utils.plots.butter_lowpass_filtfilt" href="#pancake.utils.plots.butter_lowpass_filtfilt">butter_lowpass_filtfilt</a></code></li>
<li><code><a title="pancake.utils.plots.hist2d" href="#pancake.utils.plots.hist2d">hist2d</a></code></li>
<li><code><a title="pancake.utils.plots.output_to_target" href="#pancake.utils.plots.output_to_target">output_to_target</a></code></li>
<li><code><a title="pancake.utils.plots.plot_evolution" href="#pancake.utils.plots.plot_evolution">plot_evolution</a></code></li>
<li><code><a title="pancake.utils.plots.plot_images" href="#pancake.utils.plots.plot_images">plot_images</a></code></li>
<li><code><a title="pancake.utils.plots.plot_labels" href="#pancake.utils.plots.plot_labels">plot_labels</a></code></li>
<li><code><a title="pancake.utils.plots.plot_lr_scheduler" href="#pancake.utils.plots.plot_lr_scheduler">plot_lr_scheduler</a></code></li>
<li><code><a title="pancake.utils.plots.plot_one_box" href="#pancake.utils.plots.plot_one_box">plot_one_box</a></code></li>
<li><code><a title="pancake.utils.plots.plot_one_box_PIL" href="#pancake.utils.plots.plot_one_box_PIL">plot_one_box_PIL</a></code></li>
<li><code><a title="pancake.utils.plots.plot_results" href="#pancake.utils.plots.plot_results">plot_results</a></code></li>
<li><code><a title="pancake.utils.plots.plot_results_overlay" href="#pancake.utils.plots.plot_results_overlay">plot_results_overlay</a></code></li>
<li><code><a title="pancake.utils.plots.plot_study_txt" href="#pancake.utils.plots.plot_study_txt">plot_study_txt</a></code></li>
<li><code><a title="pancake.utils.plots.plot_targets_txt" href="#pancake.utils.plots.plot_targets_txt">plot_targets_txt</a></code></li>
<li><code><a title="pancake.utils.plots.plot_test_txt" href="#pancake.utils.plots.plot_test_txt">plot_test_txt</a></code></li>
<li><code><a title="pancake.utils.plots.plot_wh_methods" href="#pancake.utils.plots.plot_wh_methods">plot_wh_methods</a></code></li>
<li><code><a title="pancake.utils.plots.profile_idetection" href="#pancake.utils.plots.profile_idetection">profile_idetection</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="pancake.utils.plots.Colors" href="#pancake.utils.plots.Colors">Colors</a></code></h4>
<ul class="">
<li><code><a title="pancake.utils.plots.Colors.hex2rgb" href="#pancake.utils.plots.Colors.hex2rgb">hex2rgb</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>